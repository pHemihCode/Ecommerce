import{s as Q,n as x,v as g,w as j,u as R,r as y,j as c,S as E,k as C,a as S,Q as q}from"./index-3987f3f0.js";import{Q as N,u as M,a as z,e as k,b as A,c as P,d as B,s as O,f as w,w as H,g as U,h as v}from"./axios-5f5fea07.js";import{u as _}from"./useDispatch-dca3303c.js";class F extends Q{constructor(t,r){super(),this.client=t,this.queries=[],this.result=[],this.observers=[],this.observersMap={},r&&this.setQueries(r)}onSubscribe(){this.listeners.size===1&&this.observers.forEach(t=>{t.subscribe(r=>{this.onUpdate(t,r)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.observers.forEach(t=>{t.destroy()})}setQueries(t,r){this.queries=t,x.batch(()=>{const s=this.observers,u=this.findMatchingObservers(this.queries);u.forEach(a=>a.observer.setOptions(a.defaultedQueryOptions,r));const n=u.map(a=>a.observer),d=Object.fromEntries(n.map(a=>[a.options.queryHash,a])),m=n.map(a=>a.getCurrentResult()),b=n.some((a,p)=>a!==s[p]);s.length===n.length&&!b||(this.observers=n,this.observersMap=d,this.result=m,this.hasListeners()&&(g(s,n).forEach(a=>{a.destroy()}),g(n,s).forEach(a=>{a.subscribe(p=>{this.onUpdate(a,p)})}),this.notify()))})}getCurrentResult(){return this.result}getQueries(){return this.observers.map(t=>t.getCurrentQuery())}getObservers(){return this.observers}getOptimisticResult(t){return this.findMatchingObservers(t).map(r=>r.observer.getOptimisticResult(r.defaultedQueryOptions))}findMatchingObservers(t){const r=this.observers,s=new Map(r.map(e=>[e.options.queryHash,e])),u=t.map(e=>this.client.defaultQueryOptions(e)),n=u.flatMap(e=>{const i=s.get(e.queryHash);return i!=null?[{defaultedQueryOptions:e,observer:i}]:[]}),d=new Set(n.map(e=>e.defaultedQueryOptions.queryHash)),m=u.filter(e=>!d.has(e.queryHash)),b=new Set(n.map(e=>e.observer)),a=r.filter(e=>!b.has(e)),p=e=>{const i=this.client.defaultQueryOptions(e),h=this.observersMap[i.queryHash];return h??new N(this.client,i)},o=m.map((e,i)=>{if(e.keepPreviousData){const h=a[i];if(h!==void 0)return{defaultedQueryOptions:e,observer:h}}return{defaultedQueryOptions:e,observer:p(e)}}),l=(e,i)=>u.indexOf(e.defaultedQueryOptions)-u.indexOf(i.defaultedQueryOptions);return n.concat(o).sort(l)}onUpdate(t,r){const s=this.observers.indexOf(t);s!==-1&&(this.result=j(this.result,s,r),this.notify())}notify(){x.batch(()=>{this.listeners.forEach(({listener:t})=>{t(this.result)})})}}function $({queries:f,context:t}){const r=R({context:t}),s=M(),u=z(),n=y.useMemo(()=>f.map(l=>{const e=r.defaultQueryOptions(l);return e._optimisticResults=s?"isRestoring":"optimistic",e}),[f,r,s]);n.forEach(l=>{k(l),A(l,u)}),P(u);const[d]=y.useState(()=>new F(r,n)),m=d.getOptimisticResult(n);B(y.useCallback(l=>s?()=>{}:d.subscribe(x.batchCalls(l)),[d,s]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),y.useEffect(()=>{d.setQueries(n,{listeners:!1})},[n,d]);const a=m.some((l,e)=>O(n[e],l,s))?m.flatMap((l,e)=>{const i=n[e],h=d.getObservers()[e];if(i&&h){if(O(i,l,s))return w(i,h,u);H(l,s)&&w(i,h,u)}return[]}):[];if(a.length>0)throw Promise.all(a);const p=d.getQueries(),o=m.find((l,e)=>{var i,h;return U({result:l,errorResetBoundary:u,useErrorBoundary:(i=(h=n[e])==null?void 0:h.useErrorBoundary)!=null?i:!1,query:p[e]})});if(o!=null&&o.error)throw o.error;return m}const I=()=>{const[f,t,r]=$({queries:[{queryKey:["walmart"],queryFn:async()=>{try{return(await v.get("https://fakestoreapiserver.reactbd.com/walmart")).data}catch(s){console.log(s)}}},{queryKey:["amazonproducts"],queryFn:async()=>{try{return(await v.get("https://fakestoreapiserver.reactbd.com/amazonproducts")).data}catch(s){console.log(s)}}},{queryKey:["nextamazon"],queryFn:async()=>{try{return(await v.get("https://fakestoreapiserver.reactbd.com/nextamazon")).data}catch(s){console.log(s)}}}]});return{walmartQuery:f,amazonproductsQuery:t,nextamazonQuery:r}};function D(){const{walmartQuery:f,amazonproductsQuery:t,nextamazonQuery:r}=I(),[s,u]=y.useState([]),n=_(),d=()=>q.success("Add to cart");(f.error||t.error||r.error)&&error.message;const m=(o,l,e,i,h)=>{n(S({id:o,title:l,image:e,oldPrice:i,price:h})),d()};y.useEffect(()=>{u(t.data)},[t.data]);const b=()=>{u(f.data)},a=()=>{u(t.data)},p=()=>{u(r.data)};return c.jsxs("div",{className:"px-2 pb-5 sm:px-4 relative top-36",children:[c.jsxs("div",{className:"flex flex-row space-x-6 mb-5 justify-center px-2 w-full",children:[c.jsx("button",{onClick:a,className:"px-3 py-1 text-white bg-slate-950",children:"Amazon "}),c.jsx("button",{onClick:p,className:"px-3 py-1 text-white bg-slate-950",children:"Next Amazon"}),c.jsx("button",{onClick:b,className:"px-3 py-1 text-white bg-slate-950",children:"Walmart"})]}),c.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 mx-4",children:s?s.map(o=>c.jsxs("div",{className:"border-2 p-3 lg:p-4 rounded-sm shadow-xl shadow-slate-100  bg-white",children:[c.jsx("div",{className:"w-52 h-60 overflow-hidden flex flex-col items-center m-auto",children:c.jsx("img",{src:o.image,alt:o.title,className:"w-full h-full duration-500 hover:scale-110"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-lg font-bold my-2 truncate",children:o.title}),c.jsxs("div",{className:"flex flex-row space-x-4 text-md",children:[o.oldPrice&&c.jsxs("p",{className:"line-through",children:["$",o.oldPrice]}),c.jsxs("p",{children:["$",o.price]})]})]}),c.jsx("button",{onClick:()=>m(o.id||o._id,o.title,o.image,o.oldPrice,o.price),className:"bg-black hover:opacity-50 text-white px-4 py-1 mb-3 rounded-md text-md",children:"Add to Cart"})]},o._id||o.id)):c.jsx(E,{animation:"border",className:"m-3"})}),c.jsx(C,{className:"w-24 px-4 shadow-none mt-3"})]})}export{D as default};
