import{U as d,V as l,r as P,j as a,W as Ce,X as be,L as Z,Y as Ee,Z as je,k as we,$ as Pe,a0 as Ne,Q as I}from"./index-3b81c2f1.js";import{u as Oe}from"./useDispatch-8b9c53fd.js";var ie="https://js.stripe.com/v3",ke=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,ee="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Re=function(){for(var e=document.querySelectorAll('script[src^="'.concat(ie,'"]')),t=0;t<e.length;t++){var n=e[t];if(ke.test(n.src))return n}return null},Ae=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(ie).concat(t);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(n),n},Ie=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"2.1.2",startTime:t})},W=null,Te=function(e){return W!==null||(W=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(ee),window.Stripe){t(window.Stripe);return}try{var o=Re();o&&e?console.warn(ee):o||(o=Ae(e)),o.addEventListener("load",function(){window.Stripe?t(window.Stripe):n(new Error("Stripe.js not available"))}),o.addEventListener("error",function(){n(new Error("Failed to load Stripe.js"))})}catch(s){n(s);return}})),W},_e=function(e,t,n){if(e===null)return null;var o=e.apply(void 0,t);return Ie(o,n),o},ce=Promise.resolve().then(function(){return Te(null)}),le=!1;ce.catch(function(r){le||console.warn(r)});var Le=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];le=!0;var o=Date.now();return ce.then(function(s){return _e(s,t,o)})};function te(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),t.push.apply(t,n)}return t}function re(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?te(Object(t),!0).forEach(function(n){ue(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):te(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function q(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?q=function(e){return typeof e}:q=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(r)}function ue(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function B(r,e){return Ue(r)||$e(r,e)||We(r,e)||qe()}function Ue(r){if(Array.isArray(r))return r}function $e(r,e){var t=r&&(typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"]);if(t!=null){var n=[],o=!0,s=!1,u,f;try{for(t=t.call(r);!(o=(u=t.next()).done)&&(n.push(u.value),!(e&&n.length===e));o=!0);}catch(i){s=!0,f=i}finally{try{!o&&t.return!=null&&t.return()}finally{if(s)throw f}}return n}}function We(r,e){if(r){if(typeof r=="string")return ne(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ne(r,e)}}function ne(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function qe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Y=function(e){var t=l.useRef(e);return l.useEffect(function(){t.current=e},[e]),t.current},T=function(e){return e!==null&&q(e)==="object"},Be=function(e){return T(e)&&typeof e.then=="function"},Me=function(e){return T(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},ae="[object Object]",Fe=function r(e,t){if(!T(e)||!T(t))return e===t;var n=Array.isArray(e),o=Array.isArray(t);if(n!==o)return!1;var s=Object.prototype.toString.call(e)===ae,u=Object.prototype.toString.call(t)===ae;if(s!==u)return!1;if(!s&&!n)return e===t;var f=Object.keys(e),i=Object.keys(t);if(f.length!==i.length)return!1;for(var E={},j=0;j<f.length;j+=1)E[f[j]]=!0;for(var w=0;w<i.length;w+=1)E[i[w]]=!0;var C=Object.keys(E);if(C.length!==f.length)return!1;var O=e,k=t,b=function(c){return r(O[c],k[c])};return C.every(b)},fe=function(e,t,n){return T(e)?Object.keys(e).reduce(function(o,s){var u=!T(t)||!Fe(e[s],t[s]);return n.includes(s)?(u&&console.warn("Unsupported prop change: options.".concat(s," is not a mutable property.")),o):u?re(re({},o||{}),{},ue({},s,e[s])):o},null):null},De="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",se=function(e){if(e===null||Me(e))return e;throw new Error(De)},Ge=function(e){if(Be(e))return{tag:"async",stripePromise:Promise.resolve(e).then(se)};var t=se(e);return t===null?{tag:"empty"}:{tag:"sync",stripe:t}},H=l.createContext(null);H.displayName="ElementsContext";var Ke=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},Q=l.createContext(null);Q.displayName="CartElementContext";var Ye=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},de=function(e){var t=e.stripe,n=e.options,o=e.children,s=l.useMemo(function(){return Ge(t)},[t]),u=l.useState(null),f=B(u,2),i=f[0],E=f[1],j=l.useState(null),w=B(j,2),C=w[0],O=w[1],k=l.useState(function(){return{stripe:s.tag==="sync"?s.stripe:null,elements:s.tag==="sync"?s.stripe.elements(n):null}}),b=B(k,2),h=b[0],c=b[1];l.useEffect(function(){var g=!0,_=function(L){c(function(U){return U.stripe?U:{stripe:L,elements:L.elements(n)}})};return s.tag==="async"&&!h.stripe?s.stripePromise.then(function(R){R&&g&&_(R)}):s.tag==="sync"&&!h.stripe&&_(s.stripe),function(){g=!1}},[s,h,n]);var x=Y(t);l.useEffect(function(){x!==null&&x!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[x,t]);var A=Y(n);return l.useEffect(function(){if(h.elements){var g=fe(n,A,["clientSecret","fonts"]);g&&h.elements.update(g)}},[n,A,h.elements]),l.useEffect(function(){var g=h.stripe;!g||!g._registerWrapper||!g.registerAppInfo||(g._registerWrapper({name:"react-stripe-js",version:"2.1.2"}),g.registerAppInfo({name:"react-stripe-js",version:"2.1.2",url:"https://stripe.com/docs/stripe-js/react"}))},[h.stripe]),l.createElement(H.Provider,{value:h},l.createElement(Q.Provider,{value:{cart:i,setCart:E,cartState:C,setCartState:O}},o))};de.propTypes={stripe:d.any,options:d.object};var M=function(e){var t=l.useContext(H);return Ke(t,e)},oe=function(e){var t=l.useContext(Q);return Ye(t,e)},He=function(){var e=M("calls useElements()"),t=e.elements;return t},Qe=function(){var e=M("calls useStripe()"),t=e.stripe;return t};d.func.isRequired;var S=function(e,t,n){var o=!!n,s=l.useRef(n);l.useEffect(function(){s.current=n},[n]),l.useEffect(function(){if(!o||!e)return function(){};var u=function(){s.current&&s.current.apply(s,arguments)};return e.on(t,u),function(){e.off(t,u)}},[o,t,e,s])},Ve=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},p=function(e,t){var n="".concat(Ve(e),"Element"),o=function(i){var E=i.id,j=i.className,w=i.options,C=w===void 0?{}:w,O=i.onBlur,k=i.onFocus,b=i.onReady,h=i.onChange,c=i.onEscape,x=i.onClick,A=i.onLoadError,g=i.onLoaderStart,_=i.onNetworksChange,R=i.onCheckout,L=i.onLineItemClick,U=i.onConfirm,pe=i.onCancel,me=i.onShippingAddressChange,he=i.onShippingRateChange,ve=M("mounts <".concat(n,">")),F=ve.elements,ye=l.useState(null),V=B(ye,2),v=V[0],xe=V[1],N=l.useRef(null),D=l.useRef(null),z=oe("mounts <".concat(n,">")),G=z.setCart,K=z.setCartState;S(v,"blur",O),S(v,"focus",k),S(v,"escape",c),S(v,"click",x),S(v,"loaderror",A),S(v,"loaderstart",g),S(v,"networkschange",_),S(v,"lineitemclick",L),S(v,"confirm",U),S(v,"cancel",pe),S(v,"shippingaddresschange",me),S(v,"shippingratechange",he);var $;e==="cart"?$=function(J){K(J),b&&b(J)}:b&&(e==="expressCheckout"?$=b:$=function(){b(v)}),S(v,"ready",$);var ge=e==="cart"?function(y){K(y),h&&h(y)}:h;S(v,"change",ge);var Se=e==="cart"?function(y){K(y),R&&R(y)}:R;S(v,"checkout",Se),l.useLayoutEffect(function(){if(N.current===null&&F&&D.current!==null){var y=F.create(e,C);e==="cart"&&G&&G(y),N.current=y,xe(y),y.mount(D.current)}},[F,C,G]);var X=Y(C);return l.useEffect(function(){if(N.current){var y=fe(C,X,["paymentRequest"]);y&&N.current.update(y)}},[C,X]),l.useLayoutEffect(function(){return function(){if(N.current&&typeof N.current.destroy=="function")try{N.current.destroy(),N.current=null}catch{}}},[]),l.createElement("div",{id:E,className:j,ref:D})},s=function(i){M("mounts <".concat(n,">")),oe("mounts <".concat(n,">"));var E=i.id,j=i.className;return l.createElement("div",{id:E,className:j})},u=t?s:o;return u.propTypes={id:d.string,className:d.string,onChange:d.func,onBlur:d.func,onFocus:d.func,onReady:d.func,onEscape:d.func,onClick:d.func,onLoadError:d.func,onLoaderStart:d.func,onNetworksChange:d.func,onCheckout:d.func,onLineItemClick:d.func,onConfirm:d.func,onCancel:d.func,onShippingAddressChange:d.func,onShippingRateChange:d.func,options:d.object},u.displayName=n,u.__elementType=e,u},m=typeof window>"u";p("auBankAccount",m);p("card",m);p("cardNumber",m);p("cardExpiry",m);p("cardCvc",m);p("fpxBank",m);p("iban",m);p("idealBank",m);p("p24Bank",m);p("epsBank",m);var ze=p("payment",m);p("expressCheckout",m);p("paymentRequestButton",m);p("linkAuthentication",m);p("address",m);p("shippingAddress",m);p("cart",m);p("paymentMethodMessaging",m);p("affirmMessage",m);p("afterpayClearpayMessage",m);function Xe(){const r=Qe(),e=He(),[t,n]=P.useState(null),[o,s]=P.useState(!1),u=async f=>{if(f.preventDefault(),!r||!e)return;s(!0);const{error:i}=await r.confirmPayment({elements:e,confirmParams:{return_url:`${window.location.origin}/success`}});i.type==="card_error"||i.type==="validation_error"?n(i.message):n("An unexpected error occured."),s(!1)};return a.jsxs("form",{id:"payment-form",className:"form w-3/4 sm:w-3/5 p-4 lg:w-full lg:mr-12 xl:3/5",onSubmit:u,children:[a.jsx(ze,{id:"payment-element"}),a.jsx("button",{className:"btn",disabled:o||!r||!e,id:"submit",children:a.jsx("span",{id:"button-text",children:o?"Processing ... ":"Pay now"})}),t&&a.jsx("div",{id:"payment-message",children:t})]})}function et(){const[r,e]=P.useState(null),[t,n]=P.useState(""),o=Ce(),[s,u]=P.useState(!0),f=be(c=>c.cart.cart),i=Oe(),[E,j]=P.useState(0),w=()=>I.success("Item removed!",{position:I.POSITION.TOP_RIGHT}),C=()=>I.success("Items removed!",{position:I.POSITION.TOP_RIGHT}),O=()=>I.error("You are not logged in!",{position:I.POSITION.TOP_RIGHT});if(P.useEffect(()=>{let c=0;for(const x of f)c+=x.price*x.quantity;j(c.toFixed(2)),u(!1)},[f]),P.useEffect(()=>{async function c(){try{const x=await fetch("http://localhost:5252/config");if(!x.ok)throw new Error("Failed to fetch configuration");const{publishableKey:A}=await x.json(),g=await Le(A);e(()=>g)}catch(x){console.log("Error initializing Stripe:",x)}}c()},[]),P.useEffect(()=>{fetch("http://localhost:5252/payment-intent",{method:"POST",body:JSON.stringify({})}).then(async c=>{var{clientSecret:x}=await c.json();n(x)}).catch(c=>{console.log("Error fetching payment intent:",c)})},[]),f.length===0)return a.jsxs("div",{className:"px-2 flex flex-col justify-center items-center w-full relative top-36",children:[a.jsx("p",{className:"text-xl  my-3",children:"No item in your cart!"}),a.jsx(Z,{to:"/",children:a.jsx("button",{className:"bg-black px-3 py-1 text-white",children:"Add Items"})})]});const k=c=>{i(Pe(c)),w()},b=()=>{i(Ne()),C()},h=()=>{o||O(),u(!s)};return a.jsxs("div",{className:"px-2 sm:px-5 relative top-36",children:[f.map(c=>a.jsx("div",{className:"p-2 my-5 rounded-sm shadow-xl shadow-slate-100",children:a.jsxs("div",{className:"sm:flex sm:flex-row sm:justify-center sm:items-center sm:space-x-10 sm:h-96 lg:w-3/5",children:[a.jsx("div",{className:"w-full sm:w-1/2 h-full overflow-hidden",children:a.jsx("img",{src:c.image,alt:c.title,className:"w-full h-full duration-500 hover:scale-110 object-cover"})}),a.jsxs("div",{className:"sm:w-1/2",children:[a.jsx("h1",{className:"text-xl font-bold my-3 truncate",children:c.title}),a.jsxs("div",{className:"flex flex-row h-8 space-x-4 text-md",children:[a.jsx("span",{children:"Price"}),c.oldPrice&&a.jsxs("p",{className:"line-through",children:["$",c.oldPrice]}),a.jsxs("p",{children:["$",(c.price*c.quantity).toFixed(2)]})]}),a.jsxs("div",{className:"flex flex-row items-center space-x-4",children:[a.jsx("p",{children:a.jsx("span",{children:"Quantity"})}),"  Â ",a.jsxs("div",{className:"flex flex-row items-center space-x-3",children:[a.jsx("p",{onClick:()=>i(Ee(c.id||c._id)),className:"text-xl font-bold",children:"+"}),a.jsx("p",{className:"text-xl text-center",children:c.quantity}),a.jsx("p",{onClick:()=>i(je(c.id||c._id)),className:"text-xl font-bold",children:"-"})]})]}),a.jsx("div",{className:"flex flex-row space-x-3",children:a.jsx("button",{onClick:()=>k(c.id||c._id),className:"bg-red-600 w-28 hover:opacity-50 text-white px-2 py-2 mb-3 rounded-md text-md",children:"Remove Item"})})]})]})},c._id||c.id)),a.jsxs("div",{className:"flex flex-row space-x-3",children:[a.jsx("button",{onClick:b,className:"bg-red-600 rounded-sm mb-5 text-md text-white px-3 py-2",children:"Remove all"}),a.jsx(Z,{to:"/",children:a.jsx("button",{className:"bg-black rounded-sm mb-5 text-md px-3 py-2 text-white",children:"Add More Items"})})]}),a.jsxs("div",{className:"lg:w-2/5 lg:absolute lg:top-10 lg:right-0",children:[a.jsxs("p",{className:"text-lg",children:["Number of selected items = ",f.length," "]}),a.jsxs("p",{className:"text-lg",children:["Total amount of selected items = $",E]}),a.jsx("button",{onClick:h,className:"bg-black text-white text-md px-3 py-1 rounded-sm",children:"Proceed to checkout"}),a.jsx("div",{className:"flex flex-col justify-center py-6 ",children:o&&s&&t&&r&&a.jsx(de,{stripe:r,options:{clientSecret:t},children:a.jsx(Xe,{})})})]}),a.jsx(we,{className:"w-24 px-4 shadow-none mt-3"})]})}export{et as default};
